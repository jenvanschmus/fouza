---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Fetch all items from the 'gallery' collection
const galleryItems = await getCollection('gallery');
---

<BaseLayout title="Gallery">
  <section class="gallery-container">
    <div class="gallery-header">
      <h1 class="univern-title">Collection Archive</h1>
      
      <div class="search-wrapper">
        <input 
          type="text" 
          id="gallery-search" 
          placeholder="SEARCH BY KEYWORD (E.G. GOLD, SAPPHIRE, RING)..."
          class="search-input"
        />
        <div class="search-line"></div>
      </div>
    </div>

    <div class="gallery-grid" id="main-grid">
      {galleryItems.map((item) => (
        <div class="gallery-card" data-description={item.data.description.toLowerCase()} data-title={item.data.title.toLowerCase()}>
          <div class="image-frame">
            <img src={item.data.image} alt={item.data.title} loading="lazy" />
          </div>
          <div class="card-info">
            <span class="item-id">REF // {item.slug.toUpperCase()}</span>
            <h3 class="item-title">{item.data.title}</h3>
            <p class="item-description">{item.data.description}</p>
          </div>
        </div>
      ))}
    </div>
  </section>
</BaseLayout>

<script>
  // Simple client-side search logic
  const searchInput = document.getElementById('gallery-search');
  const cards = document.querySelectorAll('.gallery-card');

  searchInput.addEventListener('input', (e) => {
    const searchTerm = e.target.value.toLowerCase();
    
    cards.forEach(card => {
      const content = card.getAttribute('data-description') + " " + card.getAttribute('data-title');
      if (content.includes(searchTerm)) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  });
</script>

<style>
  .gallery-container { padding: 80px 40px; max-width: 1400px; margin: 0 auto; }
  .gallery-header { text-align: center; margin-bottom: 80px; }
  
  .univern-title { font-size: 3rem; margin-bottom: 40px; letter-spacing: 0.2em; }

  /* Minimalist Search Bar */
  .search-wrapper { max-width: 600px; margin: 0 auto; position: relative; }
  .search-input {
    width: 100%;
    border: none;
    padding: 15px;
    font-size: 0.9rem;
    letter-spacing: 0.2em;
    outline: none;
    text-align: center;
    background: transparent;
  }
  .search-line { height: 1px; background: #eee; width: 100%; }

  /* Catalog Grid */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 60px 40px;
  }

  .gallery-card { transition: opacity 0.3s ease; }
  
  .image-frame {
    width: 100%;
    aspect-ratio: 1 / 1;
    background: #f9f9f9;
    overflow: hidden;
    border: 1px solid #f0f0f0;
    margin-bottom: 25px;
  }

  .image-frame img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
  }

  .gallery-card:hover img { transform: scale(1.05); }

  .item-id { font-family: 'Special Elite', monospace; font-size: 10px; color: #ccc; }
  .item-title { font-size: 1.4rem; margin: 10px 0; letter-spacing: 0.1em; }
  .item-description { font-family: sans-serif !important; font-size: 0.9rem; color: #666; line-height: 1.6; }
</style>
